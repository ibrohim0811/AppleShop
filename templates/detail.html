<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} | Batafsil</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #0A84FF;
            --accent: #5AC8FA;
            --bg: #0f0f11;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-dim: #a1a1a6;
            --success: #32D74B;
            --danger: #FF453A;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background: var(--bg);
            color: var(--text-main);
        }

        .nav-header {
            padding: 30px 5%;
        }

        .btn-back {
            text-decoration: none;
            color: var(--text-main);
            background: var(--card-bg);
            padding: 12px 24px;
            border-radius: 14px;
            border: 1px solid var(--border);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 0 20px 60px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 50px;
            background: var(--card-bg);
            border-radius: 35px;
            padding: 40px;
            border: 1px solid var(--border);
        }

        @media (max-width: 992px) {
            .product-grid { grid-template-columns: 1fr; }
        }

        .main-image {
            height: 500px;
            background: #000;
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .main-image img {
            max-width: 90%;
            max-height: 90%;
        }

        .badge {
            position: absolute;
            top: 25px;
            padding: 6px 16px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 700;
        }

        .badge-new { left: 25px; background: var(--primary); }
        .badge-sale { right: 25px; background: var(--danger); }

        .thumbnails {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .thumb {
            width: 90px;
            height: 90px;
            border-radius: 16px;
            object-fit: cover;
            opacity: 0.5;
            cursor: pointer;
        }

        .thumb.active {
            opacity: 1;
            border: 2px solid var(--primary);
        }

        .info-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .product-brand {
            color: var(--accent);
            letter-spacing: 3px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .product-name {
            font-size: 2.8rem;
            margin: 0;
        }

        .product-desc {
            color: var(--text-dim);
            line-height: 1.7;
        }

        .price-tag {
            background: rgba(255,255,255,0.03);
            padding: 25px;
            border-radius: 24px;
            border: 1px solid var(--border);
            display: flex;
            gap: 15px;
            align-items: baseline;
        }

        .current-price {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--success);
        }

        .old-price {
            text-decoration: line-through;
            color: var(--danger);
            opacity: 0.5;
        }

        .btn-cart {
            padding: 18px;
            border-radius: 18px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-weight: 700;
            cursor: pointer;
        }

        .specs-container {
            margin-top: 50px;
            background: var(--card-bg);
            border-radius: 30px;
            padding: 40px;
            border: 1px solid var(--border);
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .comments-section {
            margin-top: 50px;
        }

        .comment-form-inner {
            display: flex;
            gap: 20px;
        }

        textarea {
            flex: 1;
            background: rgba(255,255,255,0.06);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 16px;
            color: white;
            resize: none;
        }

        .comment-card {
            display: flex;
            gap: 20px;
            padding: 25px;
            margin-top: 15px;
            border-radius: 24px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .username {
            font-weight: 700;
            color: var(--accent);
        }

        .comment-time {
            font-size: 12px;
            color: var(--text-dim);
        }

        .comment-text {
            margin-top: 8px;
            color: #e5e5e7;
        }
    </style>
</head>

<body>

<div class="nav-header">
    <a href="{% url 'main_page' %}" class="btn-back">← Orqaga</a>
</div>

<div class="container">

    <div class="product-grid">
        <div>
            <div class="main-image">
                {% if product.is_new %}<span class="badge badge-new">YANGI</span>{% endif %}
                {% if product.sale > 0 %}<span class="badge badge-sale">AKSIYA</span>{% endif %}

                {% with product.images.all|first as img %}
                <img id="mainImg" src="{{ img.image.url }}">
                {% endwith %}
            </div>

            <div class="thumbnails">
                {% for img in product.images.all %}
                <img class="thumb {% if forloop.first %}active{% endif %}"
                     src="{{ img.image.url }}"
                     onclick="changeImage(this, '{{ img.image.url }}')">
                {% endfor %}
            </div>
        </div>

        <div class="info-section">
            <div class="product-brand">{{ product.brend }}</div>
            <h1 class="product-name">{{ product.name }}</h1>
            <p class="product-desc">{{ product.about }}</p>

            <div class="price-tag">
                {% if product.sale > 0 %}
                <span class="current-price">{{ product.sale_seller }} UZS</span>
                <span class="old-price">{{ product.price }} UZS</span>
                {% else %}
                <span class="current-price">{{ product.price }} UZS</span>
                {% endif %}
            </div>

            <button class="btn-cart">Savatga qo‘shish</button>
        </div>
    </div>

    <div class="specs-container">
        <h2>Xususiyatlar</h2>
        {% for key, value in product.info.items %}
        <div class="spec-item">
            <span>{{ key }}</span>
            <strong>{{ value }}</strong>
        </div>
        {% empty %}
        <p>Ma’lumotlar mavjud emas.</p>
        {% endfor %}
    </div>

    <div class="comments-section">
        <h2>Fikrlar ({{ product.comment_product.count }})</h2>

        {% if user.is_authenticated %}
        <form action="{% url 'comment' %}" method="POST">
            {% csrf_token %}
            <div class="comment-form-inner">
                <img class="user-avatar"
                     src="https://ui-avatars.com/api/?name={{ request.user.username }}&background=0A84FF&color=fff">
                <textarea name="text" rows="3" placeholder="Izoh yozing…" required></textarea>
            </div>

            <input type="hidden" name="username" value="{{ request.user.id }}">
            <input type="hidden" name="product" value="{{ product.id }}">

            <button class="btn-cart" style="margin-top:15px">Yuborish</button>
        </form>
        {% endif %}

        {% for comment in product.comment_product.all %}
        <div class="comment-card">
            <img class="user-avatar"
                 src="{% if comment.username.image %}{{ comment.username.image.url }}{% else %}https://ui-avatars.com/api/?name={{ comment.username.username }}&background=0A84FF&color=fff{% endif %}">
            <div>
                <div style="display:flex;justify-content:space-between">
                    <span class="username">@{{ comment.username.username }}</span>
                    <span class="comment-time">{{ comment.created_at|timesince }} avval</span>
                </div>
                <p class="comment-text">{{ comment.text }}</p>
            </div>
        </div>
        {% empty %}
        <p style="opacity:.6">Izohlar mavjud emas.</p>
        {% endfor %}
    </div>

</div>

<script>
function changeImage(el, src) {
    document.getElementById('mainImg').src = src;
    document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
}
</script>

</body>
</html>
